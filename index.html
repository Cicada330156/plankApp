<body>
    <audio id="doneSound" src="zapsplat_multimedia_game_tone_bright_positive_gain_award_007_25488.mp3" preload="auto"></audio>
    
    <button id="startButton" onclick="
        //GPT implementation of timer flag
        if (timerRunning) return; // Prevent multiple clicks while the timer is running
        timerRunning = true; // Set the flag to indicate the timer is running
        this.disabled = true; // Disable the button
        
        
        let length = (Math.random()*(maxPlank-minPlank))+minPlank;
        if(DEBUG){console.log('Length: ' + length);}
        if(DEBUG){console.log('min: ' + minPlank + ', max:' + maxPlank);}
        if(DEBUG){console.log('min: ' + typeof(minPlank) + ', max:' + typeof(maxPlank));}
        doneSound.onended = function () {
            alert('Your '+Math.round(length)+' second plank is done!');
            document.getElementById('message').innerHTML = '';
            
            //GPT implementation of timer flag
            timerRunning = false; // Reset the flag after the timer ends
            document.getElementById('startButton').disabled = false; // Re-enable the button
        }
    
        setTimeout(() => {
            doneSound.play();
            
            document.getElementById('message').innerHTML = 'Done';
        },length*1000);
        
        document.getElementById('message').innerHTML = 'Timer started';
    ">START</button>
    
    <h1 id="message"></h1>
    
    <br><br><h3>Update min/max times:</h3>
    <form id="lengthSettings">
        Minimum length (default 30): <input type="number" name="minVal" value="30"><br>
        Maximum length (default 60): <input type="number" name="maxVal" value="60"><br>
    </form>
    <button onclick="updatePlankInterval()">Update</button>
    <p id="updateStatus"></p>
    
    
    
    <script>
        DEBUG = false;
        minPlank = 30;
        maxPlank = 60;
        timerRunning = false;
        const doneSound = new Audio('zapsplat_multimedia_game_tone_bright_positive_gain_award_007_25488.mp3');
        
        //necessary to guarantee user interaction in order to pla
        //alert("Start timer for between "+minPlank+" and "+maxPlank+" seconds?");
        
        
        function startTimer() {
            let length = Math.random()*(maxPlank-minPlank)+minPlank;
            doneSound.onended = function () {
                alert("Your "+Math.round(length)+" second plank is done!");
                document.getElementById('message').innerHTML = "";
            }
        
            setTimeout(() => {
                doneSound.play();
                //alert("Done. Reload page to restart.");
                //document.getElementById('doneSound').play(); //https://stackoverflow.com/questions/21815323/have-sound-play-when-alert-is-triggered
                
                document.getElementById('message').innerHTML = "Done";
            },length*1000);
            
            document.getElementById('message').innerHTML = "Timer started";
        }
        
        function updatePlankInterval() {
            data = document.getElementById("lengthSettings");
            if(data.minVal.value <= 0 || data.maxVal.value <= 0) {
                updateMessageWithTimeout("updateStatus", 3000, "Value cannot be less than 0")
            }else if(data.minVal.value > data.maxVal.value){
                updateMessageWithTimeout("updateStatus", 3000, "Minimum value must be less than maximum value")
            }else{
                minPlank = parseInt(data.minVal.value);
                maxPlank = parseInt(data.maxVal.value);
                updateMessageWithTimeout("updateStatus", 3000, "New min: " + minPlank + ", new max: " + maxPlank)
            }
        }
        
        //updates the message box, then returns it to its previous message. Has no error correction if it runs twice.
        //@TODO add error correction - perhaps a global hashmap to store the go-to previous value
        function updateMessageWithTimeout(messageBoxId, timeout, message) {
            priorMessage = document.getElementById(messageBoxId).innerHTML
            document.getElementById(messageBoxId).innerHTML = message;
            setTimeout(() => {
                document.getElementById(messageBoxId).innerHTML = priorMessage;
            }, timeout);
        }
    </script>
</body>